<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monsters and Treasure</title>
    <link rel="icon" type="image/png" href="/static/favicon/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/favicon.png">
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        .game-stats {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 1rem 0;
            width: 100%;
        }

        .stat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 0;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #333;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #1e40af;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-bar.increase {
            background-color: #1ae866;
            transition: background-color 1s ease;
        }

        .progress-bar.decrease {
            background-color: #cc0a0a;
            transition: background-color 1s ease;
        }

        .stat-value {
            font-weight: bold;
            min-width: 3em;
            text-align: right;
            margin-left: 0.5rem;
        }

        /* Add animation for game images */
        .game-image {
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.5s ease-out;
            max-width: 256px;
            margin: 0 auto;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }

        .game-image.show {
            opacity: 1;
            transform: scale(1);
        }

        /* Combat outcome images specific styles */
        .combat-outcome {
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header class="game-header">
            <h1 class="game-title">Monsters and Treasure</h1>
            % if player_stats and get('previous_stats'):
            <div class="game-stats">
                <div class="stat-container">
                    <div class="stat-label">
                        <span>❤️ Health</span>
                        <span class="stat-value">{{player_stats['health']}}</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar health-bar" 
                             data-value="{{player_stats['health']}}" 
                             data-previous="{{previous_stats['health']}}"
                             data-max="100"
                             style="width: {{player_stats['health']}}%">
                        </div>
                    </div>
                </div>
                <div class="stat-container">
                    <div class="stat-label">
                        <span>⭐️ Score</span>
                        <span class="stat-value">{{player_stats['score']}}</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar score-bar" 
                             data-value="{{player_stats['score']}}"
                             data-previous="{{previous_stats['score']}}"
                             data-max="100"
                             style="width: {{min(100, (player_stats['score'] / max(100, player_stats['score'])) * 100)}}%">
                        </div>
                    </div>
                </div>
                <div class="stat-container">
                    <div class="stat-label">
                        <span>✨ XP</span>
                        <span class="stat-value">{{player_stats['xp']}}</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar xp-bar" 
                             data-value="{{player_stats['xp']}}"
                             data-previous="{{previous_stats['xp']}}"
                             data-max="200"
                             style="width: {{(player_stats['xp'] / 200) * 100}}%">
                        </div>
                    </div>
                </div>
            </div>
            % end
        </header>
        
        <main class="game-content">
            % if get('event_type'):
            <div class="mb-6 text-center">
                % if event_type == 'monster':
                <img src="/static/images/monster.png" alt="Monster" class="game-image">
                % elif event_type == 'treasure':
                <img src="/static/images/treasure.png" alt="Treasure" class="game-image">
                % elif event_type == 'trap':
                <img src="/static/images/trap.png" alt="Trap" class="game-image">
                % elif event_type == 'local':
                <img src="/static/images/local.png" alt="Local Helper" class="game-image">
                % elif event_type == 'combat_victory':
                <img src="/static/images/combat/victory.png" alt="Combat Victory" class="game-image combat-outcome">
                % elif event_type == 'combat_defeat':
                <img src="/static/images/combat/defeat.png" alt="Combat Defeat" class="game-image combat-outcome">
                % elif event_type == 'combat_escape':
                <img src="/static/images/combat/escape.png" alt="Combat Escape" class="game-image combat-outcome">
                % end
            </div>
            % end
            
            <div class="game-message">
                {{message}}
            </div>

            <div class="game-options">
                % if show_name_input:
                <form action="/start" method="post" class="space-y-4">
                    <input type="text" name="player_name" placeholder="Enter your name" required class="input w-full">
                    <button type="submit" class="btn-primary w-full">Start Adventure</button>
                </form>
                % end
                
                % if show_choices:
                <form action="/choice" method="post" class="space-y-3">
                    <button type="submit" name="choice" value="adventure" class="btn-primary w-full">Go on Adventure</button>
                    <button type="submit" name="choice" value="rest" class="btn-secondary w-full">Rest</button>
                </form>
                % end

                % if show_treasure_choices:
                <form action="/choice" method="post" class="space-y-3">
                    <button type="submit" name="choice" value="search_alone" class="btn-primary w-full">Search Alone</button>
                    <button type="submit" name="choice" value="get_help" class="btn-secondary w-full">Get Help (10 points)</button>
                    <button type="submit" name="choice" value="ignore" class="btn-secondary w-full">Ignore</button>
                </form>
                % end

                % if show_monster_choices:
                <form action="/choice" method="post" class="space-y-3">
                    <button type="submit" name="choice" value="fight" class="btn-primary w-full">Fight</button>
                    <button type="submit" name="choice" value="run" class="btn-secondary w-full">Run</button>
                </form>
                % end
            </div>
        </main>

        <footer class="mt-8 text-center">
            <a href="/leaderboard" class="btn-secondary inline-block">View Leaderboard</a>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add animation for game images
        function showGameImages() {
            const images = document.querySelectorAll('.game-image');
            images.forEach(img => {
                // Wait for image to load
                if (img.complete) {
                    setTimeout(() => img.classList.add('show'), 100);
                } else {
                    img.onload = () => setTimeout(() => img.classList.add('show'), 100);
                }
            });
        }

        // Run image animations
        showGameImages();

        function updateProgressBars() {
            const bars = document.querySelectorAll('.progress-bar');
            
            bars.forEach(bar => {
                const currentValue = parseFloat(bar.getAttribute('data-value'));
                const previousValue = parseFloat(bar.getAttribute('data-previous'));
                
                if (currentValue !== previousValue) {
                    // Remove existing classes first
                    bar.classList.remove('increase', 'decrease');
                    
                    // Force a reflow
                    void bar.offsetWidth;
                    
                    // Add appropriate class based on value change
                    if (currentValue > previousValue) {
                        bar.classList.add('increase');
                    } else if (currentValue < previousValue) {
                        bar.classList.add('decrease');
                    }
                    
                    // Schedule removal of animation classes
                    setTimeout(() => {
                        bar.classList.remove('increase', 'decrease');
                    }, 1000);
                }
            });
        }

        // Run animation check immediately after page load
        updateProgressBars();
        
        // Also run when the page content updates
        const observer = new MutationObserver(updateProgressBars);
        observer.observe(document.body, { 
            childList: true, 
            subtree: true 
        });
    });
    </script>
</body>
</html> 